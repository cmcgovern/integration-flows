{"id":37272,"name":"Imagine_SyncplicityOnboarding","userId":54789,"accountId":42187,"createdDate":"2020-06-30T13:47:34Z","steps":[{"id":349382,"onSuccess":["createSyncUser"],"onFailure":[],"name":"consoleLog","type":"script","properties":{"body":"console.log(info);\nconsole.log(trigger);\nconsole.log(steps);\nconsole.log(config);"}},{"id":349381,"onSuccess":["createSyncUser"],"onFailure":[],"name":"consoleLog1","type":"script","properties":{"body":"console.log(trigger.args.dirPath);"}},{"id":349380,"onSuccess":[],"onFailure":[],"name":"consoleLogEnd","type":"script","properties":{"body":"console.log(steps.getUserGUID);\nthrow (error);"}},{"id":349379,"onSuccess":[],"onFailure":[],"name":"createSubfolder","type":"httpRequest","properties":{"body":"${steps.mkdirPayload.mkdir}","url":"https://api.syncplicity.com/sync/folders.svc/${steps.mkdirPayload.syncId}/folders","method":"POST","headers":"${steps.mkdir.headers}"}},{"id":349378,"onSuccess":[],"onFailure":[],"name":"createSyncpoint","type":"httpRequest","properties":{"body":"${steps.mksyncPayload.mksync}","url":"https://api.syncplicity.com/syncpoint/syncpoints.svc/","method":"POST","headers":"${steps.mksyncPayload.headers}"}},{"id":349377,"onSuccess":["getUserGUID"],"onFailure":[],"name":"createSyncUser","type":"elementRequest","properties":{"body":"${steps.syncPayload.user}","method":"POST","api":"/users","query":"","elementInstanceId":"${config.sync}"}},{"id":349376,"onSuccess":["getFolderId"],"onFailure":[],"name":"createUserDir","type":"elementRequest","properties":{"body":"${steps.syncPayload.mkdir}","method":"POST","api":"/folders","elementInstanceId":"${config.sync}"}},{"id":349375,"onSuccess":[],"onFailure":[],"name":"error","type":"script","properties":{"body":"throw (error);"}},{"id":349374,"onSuccess":[],"onFailure":[],"name":"failme","type":"script","properties":{"body":"console.log(\"ID: \"+steps.getFolderId.response.body.id);\nthrow (error);"}},{"id":349373,"onSuccess":["shareFolder"],"onFailure":[],"name":"getFolderId","type":"elementRequest","properties":{"method":"GET","api":"/folders/metadata?path=${steps.syncPayload.fullPath}","query":"","elementInstanceId":"${config.sync}","path":""}},{"id":349372,"onSuccess":["createUserDir"],"onFailure":[],"name":"getUserGUID","type":"elementRequest","properties":{"method":"GET","api":"/users/${trigger.args.emailAddress}","elementInstanceId":"${config.sync}"}},{"id":349371,"onSuccess":[],"onFailure":[],"name":"mkdir","type":"script","properties":{"body":"var baseDir = \"imagine/inventory/\";\r\nvar userDir = trigger.args.firstName+\".\"+trigger.args.lastName;\r\nconsole.log(\"Basedir: \"+baseDir);\r\nconsole.log(\"Userdir: \"+userDir);\r\n\r\n// OAuth token may be subject to change. Run a standard request through to grab it.\r\n// let headers = {\"Authorization\":\"Bearer Vr1Qf1pTzWdxOGAJvDnYiJDMcIr2fYY8pkzvt4Io8f5P0Ukik4blpz\", \"Accept\": \"application/json\", \"Content-Type\": \"application/json\"};\r\n\r\nvar mkdir = {\r\n    \"directory\": true,\r\n    \"includeType\": \"0\",\r\n    \"name\": userDir,\r\n    \"path\": baseDir+userDir,\r\n    \"size\": 0\r\n};\r\n\r\ndone({mkdir:mkdir});"}},{"id":349370,"onSuccess":[],"onFailure":[],"name":"mkdirPayload","type":"script","properties":{"body":"var syncId = steps.createSyncpoint.response.body[0].Id;\r\n\r\nvar baseDir = \"imagine/inventory\";\r\n\r\nvar syncpoint = trigger.args.firstName+\".\"+trigger.args.lastName;\r\n\r\n\r\nvar mkdir = [{\r\n    \"SyncpointId\": syncId,\r\n    \"Name\": \"Inventory\",\r\n    \"Status\": 1,\r\n    \"VirtualPath\": \"/Inventory/\"\r\n}];\r\n\r\ndone({mkdir:mkdir, syncId:syncId});"}},{"id":349369,"onSuccess":[],"onFailure":[],"name":"shareFolder","type":"elementRequest","properties":{"body":"${steps.syncPayload.sharedir}","method":"POST","api":"/folders/${steps.getFolderId.response.body.id}/participants","elementInstanceId":"${config.sync}"}},{"id":349368,"onSuccess":["createSyncUser"],"onFailure":[],"name":"syncPayload","type":"script","properties":{"body":"var user = [{\r\n  \"EmailAddress\" : trigger.args.emailAddress,\r\n  \"FirstName\" : trigger.args.firstName,\r\n  \"LastName\" : trigger.args.lastName,\r\n  \"AccountType\" : 7,\r\n}];\r\n\r\nvar baseDir = \"/imagine/inventory/\";\r\nvar userDir = trigger.args.firstName+\".\"+trigger.args.lastName;\r\nvar fullPath = baseDir+userDir;\r\n\r\n// includeType maps to type against /syncpoint/syncpoints.svc/\r\nvar mkdir = {\r\n    \"directory\": true,\r\n    \"includeType\": \"0\",\r\n    \"name\": userDir,\r\n    \"path\": fullPath,\r\n    \"size\": 0\r\n};\r\n\r\n//ReadWrite access = 1\r\nvar sharedir = {\r\n  \"Permission\": \"1\",\r\n  \"User\": {\r\n    \"EmailAddress\": trigger.args.emailAddress\r\n  }\r\n};\r\n\r\ndone({user:user, mkdir:mkdir, sharedir:sharedir, fullPath:fullPath});"}}],"triggers":[{"id":33247,"onSuccess":["syncPayload"],"onFailure":[],"type":"manual","async":true,"active":true,"name":"trigger","properties":{}}],"engine":"v3","active":true,"debugLoggingEnabled":false,"singleThreaded":false,"configuration":[{"id":71773,"key":"sync","name":"sync","type":"elementInstance","required":true}]}